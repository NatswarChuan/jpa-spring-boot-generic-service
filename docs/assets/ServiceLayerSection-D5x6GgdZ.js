import{_ as l}from"./CodeBlock-CUrVyKBF.js";import{f as a,c as o,o as n,b as t,a as s,e as i,d as c}from"./index-ByupLFOq.js";const p={id:"service-layer",class:"scroll-mt-20 mb-16"},b={id:"core-service",class:"mb-10 scroll-mt-24"},x={class:"bg-slate-50 rounded-lg p-5 border border-slate-200 font-mono text-sm overflow-x-auto"},m={id:"service-hooks",class:"mb-10 scroll-mt-24"},v={class:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-6"},u={class:"space-y-4"},w={__name:"ServiceLayerSection",setup(g){const r=a(`package com.example.demo.service;

import com.example.demo.domain.Product;
import com.example.demo.repository.ProductRepository;
import com.natswarchuan.genericservice.service.AbService;
import org.springframework.stereotype.Service;
import org.springframework.lang.NonNull;

/**
 * Service xử lý nghiệp vụ cho Product.
 * Kế thừa AbService để tận dụng logic CRUD có sẵn.
 */
@Service
public class ProductService extends AbService<Product, Long> {

    public ProductService(@NonNull ProductRepository repository) {
        super(repository);
    }
}
`),d=a(`@Override
protected Product beforeCreate(Product entity) {
    // Tự động tính toán giá khuyến mãi
    if (entity.getPrice().compareTo(BigDecimal.valueOf(1000)) > 0) {
        entity.setPrice(entity.getPrice().multiply(BigDecimal.valueOf(0.9)));
    }
    return entity;
}

@Override
protected Product afterCreate(Product entity) {
    // Gửi thông báo sau khi tạo thành công
    notificationService.send("New product added: " + entity.getName());
    return entity;
}
`);return(h,e)=>(n(),o("section",p,[e[6]||(e[6]=t("h2",{class:"text-3xl font-bold text-slate-900 border-b pb-4 mb-8"},"7. Tầng Service",-1)),e[7]||(e[7]=t("p",{class:"text-slate-600 italic mb-6"},"Xử lý logic nghiệp vụ và tích hợp các life-cycle hooks.",-1)),t("article",b,[e[1]||(e[1]=s('<h3 class="text-xl font-bold text-slate-800 mb-6"><span class="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm mr-3">7.1</span> Lựa chọn Base Class </h3><p class="text-slate-600 mb-6"> Framework cung cấp các lớp cơ sở (Base Classes) theo mô hình phân tầng. Thay vì luôn dùng <code>AbService</code> (All-in-One), bạn hãy chọn lớp phù hợp nhất với nhu cầu để tối ưu code. </p><div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8"><div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm hover:border-blue-400 transition-colors"><div class="flex items-center gap-2 mb-3"><span class="bg-amber-100 text-amber-700 px-2 py-1 rounded text-xs font-bold uppercase">Base</span><h4 class="font-bold text-slate-800">AbReadSummaryService</h4></div><p class="text-sm text-slate-500 mb-4 h-10">Chỉ cần xem danh sách và phân trang?</p><ul class="text-sm text-slate-600 space-y-2 mb-4"><li class="flex items-center"><span class="text-green-500 mr-2">✓</span> findAll (Page/List)</li><li class="flex items-center"><span class="text-green-500 mr-2">✓</span> exists, count</li></ul></div><div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm hover:border-blue-400 transition-colors"><div class="flex items-center gap-2 mb-3"><span class="bg-orange-100 text-orange-700 px-2 py-1 rounded text-xs font-bold uppercase">Base</span><h4 class="font-bold text-slate-800">AbReadDetailService</h4></div><p class="text-sm text-slate-500 mb-4 h-10">Cần xem chi tiết từng bản ghi?</p><ul class="text-sm text-slate-600 space-y-2 mb-4"><li class="flex items-center"><span class="text-blue-500 mr-2">➜</span> Tất cả của Summary</li><li class="flex items-center"><span class="text-green-500 mr-2">✓</span> findById, findOne</li></ul></div><div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm hover:border-blue-400 transition-colors"><div class="flex items-center gap-2 mb-3"><span class="bg-pink-100 text-pink-700 px-2 py-1 rounded text-xs font-bold uppercase">Base</span><h4 class="font-bold text-slate-800">AbCreateService</h4></div><p class="text-sm text-slate-500 mb-4 h-10">Chỉ cho phép đọc và tạo mới?</p><ul class="text-sm text-slate-600 space-y-2 mb-4"><li class="flex items-center"><span class="text-blue-500 mr-2">➜</span> Tất cả của Read Detail</li><li class="flex items-center"><span class="text-green-500 mr-2">✓</span> create (Entity/DTO)</li></ul></div><div class="bg-white rounded-xl border border-slate-200 p-5 shadow-sm hover:border-blue-400 transition-colors"><div class="flex items-center gap-2 mb-3"><span class="bg-purple-100 text-purple-700 px-2 py-1 rounded text-xs font-bold uppercase">Base</span><h4 class="font-bold text-slate-800">AbUpdateService</h4></div><p class="text-sm text-slate-500 mb-4 h-10">Cho phép chỉnh sửa dữ liệu?</p><ul class="text-sm text-slate-600 space-y-2 mb-4"><li class="flex items-center"><span class="text-blue-500 mr-2">➜</span> Tất cả của Create</li><li class="flex items-center"><span class="text-green-500 mr-2">✓</span> update, save</li></ul></div><div class="bg-indigo-50 rounded-xl border border-indigo-200 p-5 shadow-sm relative overflow-hidden col-span-1 md:col-span-2 lg:col-span-2"><div class="absolute right-0 top-0 w-24 h-24 bg-indigo-100 rounded-bl-full -mr-10 -mt-10 opacity-50"></div><div class="flex items-center gap-2 mb-3 relative z-10"><span class="bg-indigo-600 text-white px-2 py-1 rounded text-xs font-bold uppercase shadow">Recommended</span><h4 class="font-bold text-indigo-900">AbService (Full Option)</h4></div><p class="text-sm text-indigo-700 mb-4 h-10 relative z-10">Giải pháp toàn diện cho hầu hết các trường hợp.</p><div class="grid grid-cols-2 gap-4 relative z-10"><ul class="text-sm text-indigo-800 space-y-2"><li class="flex items-center font-semibold"><span class="text-indigo-600 mr-2">➜</span> Tất cả các tính năng trên</li></ul><ul class="text-sm text-indigo-800 space-y-2"><li class="flex items-center"><span class="text-green-600 mr-2 font-bold">✓</span> delete (Soft/Hard delete逻辑)</li></ul></div></div></div>',3)),t("div",x,[e[0]||(e[0]=t("p",{class:"text-slate-500 mb-2"},"// Ví dụ: Service chuẩn kế thừa AbService",-1)),i(l,{filename:"ProductService.java",code:r.value},null,8,["code"])])]),t("article",m,[e[4]||(e[4]=t("h3",{class:"text-xl font-bold text-slate-800 mb-3"},[t("span",{class:"bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-sm mr-3"},"7.2"),c(" Các Hooks Vòng đời ")],-1)),e[5]||(e[5]=t("p",{class:"text-slate-600 mb-6"},' Cơ chế "Hook" cho phép bạn can thiệp vào lồng xử lý (trước hoặc sau khi lưu DB) mà không cần viết lại toàn bộ logic CRUD. ',-1)),t("div",v,[e[3]||(e[3]=s('<div class="space-y-6"><div class="bg-slate-50 rounded-xl p-6 border border-slate-200"><h4 class="font-bold text-slate-700 mb-4 flex items-center"><span class="w-2 h-6 bg-amber-500 rounded-sm mr-2"></span> Luồng Ghi (Create/Update/Delete) </h4><div class="relative pl-4 border-l-2 border-slate-300 space-y-6"><div class="relative"><div class="absolute -left-[23px] top-1 w-3 h-3 rounded-full bg-slate-400 border-2 border-white"></div><div class="text-sm font-bold text-slate-400 uppercase text-xs mb-1">Input</div><div class="text-slate-600 text-sm">Entity từ Controller</div></div><div class="relative"><div class="absolute -left-[25px] top-0 w-4 h-4 rounded-full bg-amber-500 border-2 border-white shadow-sm ring-1 ring-amber-200"></div><div class="text-sm font-bold text-amber-700 text-xs mb-1 bg-amber-50 inline-block px-2 py-0.5 rounded">HOOK: beforeCreate/Update/Delete</div><div class="text-slate-600 text-xs">Validation, set default, check business rules...</div></div><div class="relative"><div class="absolute -left-[23px] top-1 w-3 h-3 rounded-full bg-blue-500 border-2 border-white"></div><div class="text-sm font-bold text-blue-700 text-xs mb-1">Repository Action</div><div class="text-slate-600 text-xs">Save / Delete xuống DB</div></div><div class="relative"><div class="absolute -left-[25px] top-0 w-4 h-4 rounded-full bg-purple-500 border-2 border-white shadow-sm ring-1 ring-purple-200"></div><div class="text-sm font-bold text-purple-700 text-xs mb-1 bg-purple-50 inline-block px-2 py-0.5 rounded">HOOK: afterCreate/Update/Delete</div><div class="text-slate-600 text-xs">Audit log, notification, trigger events...</div></div></div></div><div class="bg-sky-50 rounded-xl p-6 border border-sky-200"><h4 class="font-bold text-sky-800 mb-4 flex items-center"><span class="w-2 h-6 bg-sky-500 rounded-sm mr-2"></span> Luồng Đọc (Read) </h4><div class="relative pl-4 border-l-2 border-sky-300 space-y-6"><div class="relative"><div class="absolute -left-[23px] top-1 w-3 h-3 rounded-full bg-blue-500 border-2 border-white"></div><div class="text-sm font-bold text-blue-700 text-xs mb-1">Repository.find...()</div><div class="text-slate-600 text-xs">Lấy dữ liệu thô từ Database</div></div><div class="relative"><div class="absolute -left-[25px] top-0 w-4 h-4 rounded-full bg-sky-500 border-2 border-white shadow-sm ring-1 ring-sky-200"></div><div class="text-sm font-bold text-sky-700 text-xs mb-1 bg-white inline-block px-2 py-0.5 rounded border border-sky-100">HOOK: afterReadEntity(entity)</div><div class="text-slate-600 text-xs">Tính toán transient fields, filter nhạy cảm trên Entity...</div></div><div class="relative"><div class="absolute -left-[23px] top-1 w-3 h-3 rounded-full bg-slate-400 border-2 border-white"></div><div class="text-sm font-bold text-slate-500 text-xs mb-1">Map to DTO</div><div class="text-slate-600 text-xs">Chuyển đổi Entity -&gt; DTO</div></div><div class="relative"><div class="absolute -left-[25px] top-0 w-4 h-4 rounded-full bg-indigo-500 border-2 border-white shadow-sm ring-1 ring-indigo-200"></div><div class="text-sm font-bold text-indigo-700 text-xs mb-1 bg-white inline-block px-2 py-0.5 rounded border border-indigo-100">HOOK: afterReadDto(dto)</div><div class="text-slate-600 text-xs">Enrich data từ service khác, format dữ liệu cho FE...</div></div></div></div></div>',1)),t("div",u,[e[2]||(e[2]=s('<div class="bg-indigo-50 p-4 rounded-lg border border-indigo-100 mb-2"><h4 class="font-bold text-indigo-900 text-sm mb-2">Các Hook khả dụng:</h4><ul class="grid grid-cols-1 gap-2 text-xs font-mono text-indigo-800"><li><span class="text-amber-600">beforeCreate</span> / <span class="text-purple-600">afterCreate</span></li><li><span class="text-purple-600">afterReadEntity</span> / <span class="text-purple-600">afterReadDto</span></li><li><span class="text-amber-600">beforeUpdate</span> / <span class="text-purple-600">afterUpdate</span></li><li><span class="text-amber-600">beforeDelete</span> / <span class="text-purple-600">afterDelete</span></li></ul></div>',1)),i(l,{filename:"ProductService.java (Example)",code:d.value},null,8,["code"])])])])]))}};export{w as default};
